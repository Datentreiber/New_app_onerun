version: 2
id: "ndvi_timelapse"
title: "NDVI Timelapse (Monatsverlauf)"
purpose: "Vegetationsverlauf über ein Jahr als DOY-Median-Animation zeigen."

param_spec:
  required:
    - id: aoi_spec
      type: object
      variants:
        - { type: "bbox", bbox: [0, 0, 0, 0] }
        - { type: "point_buffer", point: [0, 0], radius_km: 0 }
        - { type: "place", name: "", radius_km: 0 }
      ask_policy: "always"
  optional:
    - id: ref_year
      type: int
      range: [2001, 2025]
      default: 2019
      ask_policy: "prefer"
    - id: fps
      type: int
      range: [1, 24]
      default: 10
      ask_policy: "prefer"
    - id: dimensions
      type: int
      range: [256, 2048]
      default: 600
      ask_policy: "prefer"
    - id: crs
      type: string
      default: "EPSG:3857"
      ask_policy: "prefer"

ui_widgets_library:
  year_slider_int: "blocks/components/ui/slider_int.py"
  year_number_input: "blocks/components/ui/number_input_int.py"

invariants:
  dataset: "MODIS/061/MOD13A2"
  band: "NDVI"
  composite_method: "median_per_DOY"


visualize_presets:
  - id: "ndvi_default"
    vis_params:
      min: 0.0
      max: 9000.0
      palette: ["#FFFFFF","#CE7E45","#DF923D","#F1B555","#FCD163","#99B718","#74A901","#66A000","#529400","#3E8601","#207401","#056201","#004C00","#023B01","#012E01","#011D01","#011301"]
      opacity: 1.0

allowed_patterns:
  - "Scaffold → Acquire → Process → Reduce → Visualize → Render"

capabilities_required: ["aoi"]
capabilities_provided: ["ndvi_doy_composite","animation","single_map"]

ui_contracts:
@@ -67,4 +49,4 @@
few_shot_components:
  - "blocks/components/gee/aoi_from_spec.py"
  - "blocks/components/gee/ndvi_acquire_process.py"
  - "blocks/components/visual/map_plus_gif.py"
