version: 2
id: "ndvi_timelapse"
title: "NDVI Timelapse (Monatsverlauf)"
purpose: "Vegetationsverlauf über ein Jahr als DOY-Median-Animation zeigen."

param_spec:
  required:
    - id: aoi_spec
      type: object
      variants:
        - { type: "bbox", bbox: [0, 0, 0, 0] }
        - { type: "point_buffer", point: [0, 0], radius_km: 0 }
        - { type: "place", name: "", radius_km: 0 }
      ask_policy: "always"
  optional:
    - id: ref_year
      type: int
      range: [2015, 2035]
      default: 2024

invariants:
  sensor: "Sentinel-2 SR"
  scale_m: 10
  ndvi_bands: ["B8","B4"]
  doy_bins: 12

visualize_presets:
  - id: "ndvi_default"
    vis_params:
      min: 0.1
      max: 0.9
      palette: ["#440154","#3b528b","#21908d","#5dc962","#fde725"]
      opacity: 1.0

allowed_patterns:
  - "Scaffold → Acquire → Process → Reduce → Visualize → Render"

capabilities_required: ["aoi","animation"]
capabilities_provided: ["ndvi_doy_composite","animation","single_map"]

ui_contracts:
  variables_map: {}

render_pattern: "map_plus_gif"

checks:
  - "Wenn DOY-Collection leer ist: Hinweis ausgeben (Account/Zeitraum prüfen)."

few_shot_components:
  - "blocks/components/gee/aoi_from_spec.py"
  - "blocks/components/gee/ndvi_acquire_process.py"
  - "blocks/components/visual/ndvi_timelapse_panel.py"
