version: 2
id: "s2_visual"
title: "Sentinel-2 Vierteljahres-Mosaik (FCC)"
purpose: "Cloud-gefiltertes S2-Vierteljahres-Mosaik, wählbare Band-Triplets."

param_spec:
  required:
    - id: aoi_spec
      type: object
      variants:
        - { type: "bbox", bbox: [0, 0, 0, 0] }
        - { type: "point_buffer", point: [0, 0], radius_km: 0 }
        - { type: "place", name: "", radius_km: 0 }
      ask_policy: "always"
    - id: time_year
      type: int
      range: [2016, 2025]
      default: "current_year"
      ask_policy: "always"
    - id: quarter
      type: int
      range: [1, 4]
      ask_policy: "always"
  optional:
    - id: viz_type
      type: string
      default: "Natural Color (Red/Green/Blue)"
      ask_policy: "prefer"

ui_widgets_library:
  year_slider_int: "blocks/components/ui/slider_int.py"
  year_number_input: "blocks/components/ui/number_input_int.py"

invariants:
  dataset: "COPERNICUS/S2_HARMONIZED"
  cloud_filter: "CLOUDY_PIXEL_PERCENTAGE ≤ 10"
  reflectance_scale: "divide(10000)"
  map_params:
    "Natural Color (Red/Green/Blue)": ["B4","B3","B2"]
    "Vegetation": ["B12","B8","B4"]
    "Land/Water": ["B8","B11","B4"]
    "Color Infrared": ["B8","B4","B3"]
  default_viz_type: "Natural Color (Red/Green/Blue)"

visualize_presets:
  - id: "s2_shared_default"
    vis_params:
      min: 0.0
      max: 0.325
      gamma: 1.0
      opacity: 1.0

allowed_patterns:
  - "Scaffold → Acquire → Process → Reduce → Visualize → Render"

capabilities_required: ["aoi","time_window"]
capabilities_provided: ["mosaic","split_map"]

ui_contracts:
  bindings:
    time_year: "int"
    quarter: "int"
  variables_map:
    year: "time_year"

render_pattern: "split_map_right"

checks:
  - "Wenn Mosaik leer ist: Hinweis (Wolkenfilter zu streng?)."

few_shot_components:
  - "blocks/components/gee/aoi_from_spec.py"
  - "blocks/components/gee/s2_mosaic_acquire_process.py"
  - "blocks/components/visual/split_map_right.py"
