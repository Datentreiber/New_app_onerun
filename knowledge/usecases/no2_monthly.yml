version: 2
id: "no2_monthly"
title: "NO₂ Monatsmittel (TROPOMI)"
purpose: "Monatliches Mittel der troposphärischen NO₂-Säule kartieren."

param_spec:
  required:
    - id: aoi_spec
      type: object
      variants:
        - { type: "bbox", bbox: [0, 0, 0, 0] }
        - { type: "point_buffer", point: [0, 0], radius_km: 0 }
        - { type: "place", name: "", radius_km: 0 }
      ask_policy: "always"
    - id: time_year
      type: int
      range: [2018, 2025]
      default: "current_year"
      ask_policy: "always"
    - id: time_month
      type: int
      range: [1, 12]
      ask_policy: "always"

ui_widgets_library:
  year_slider_int: "blocks/components/ui/slider_int.py"
  year_number_input: "blocks/components/ui/number_input_int.py"

invariants:
  dataset: "COPERNICUS/S5P/NRTI/L3_NO2"
  band: "NO2_column_number_density"
  reduce: "mean_month"

visualize_presets:
  - id: "no2_default"
    vis_params:
      min: 0.0
      max: 0.0002
      palette: ["#000000","#120E3B","#3E1E60","#7C1D6F","#B01764","#D13A4E","#E66D3C"]
      opacity: 1.0

allowed_patterns:
  - "Scaffold → Acquire → Process → Reduce → Visualize → Render"

capabilities_required: ["aoi","time_window"]
capabilities_provided: ["single_map"]

ui_contracts:
  bindings:
    time_year: "int"
    time_month: "int"
  variables_map:
    year: "time_year"
    month: "time_month"

render_pattern: "split_map_right"

checks:
  - "Wenn das Monatsfenster keine Bilder enthält: Hinweis anzeigen (Monat/Region prüfen)."

few_shot_components:
  - "blocks/components/gee/aoi_from_spec.py"
  - "blocks/components/gee/no2_acquire_process.py"
  - "blocks/components/visual/split_map_right.py"
